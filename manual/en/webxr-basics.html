<!DOCTYPE html><html lang="fr"><head>
    <meta charset="utf-8">
    <title>VR</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@threejs">
    <meta name="twitter:title" content="Three.js – VR">
    <meta property="og:image" content="https://threejs.org/files/share.png">
    <link rel="shortcut icon" href="../../files/favicon_white.ico" media="(prefers-color-scheme: dark)">
    <link rel="shortcut icon" href="../../files/favicon.ico" media="(prefers-color-scheme: light)">

    <link rel="stylesheet" href="../resources/lesson.css">
    <link rel="stylesheet" href="../resources/lang.css">
<script type="importmap">
{
  "imports": {
    "three": "../../build/three.module.js"
  }
}
</script>
  </head>
  <body>
    <div class="container">
      <div class="lesson-title">
        <h1>VR</h1>
      </div>
      <div class="lesson">
        <div class="lesson-main">
          <p>Créer une application VR avec three.js est assez simple. Il suffit essentiellement de dire à three.js que vous souhaitez utiliser WebXR. En y réfléchissant, plusieurs points concernant WebXR devraient être clairs. La direction dans laquelle la caméra pointe est fournie par le système VR lui-même, puisque l'utilisateur tourne la tête pour choisir une direction. De même, le champ de vision et l'aspect seront fournis par le système VR, car chaque système a un champ de vision et un aspect d'affichage différents.</p>
<p>Prenons un exemple tiré de l'article sur <a href="responsive.html">la création d'une page web responsive</a> et rendons-le compatible avec la VR.</p>
<p>Avant de commencer, vous aurez besoin d'un appareil compatible VR, comme un smartphone Android, Google Daydream, Oculus Go, Oculus Rift, Vive, Samsung Gear VR, ou un iPhone avec un <a href="https://apps.apple.com/us/app/webxr-viewer/id1295998056">navigateur WebXR</a>.</p>
<p>Ensuite, si vous exécutez localement, vous devez lancer un simple serveur web, comme expliqué dans <a href="setup.html">l'article sur la configuration</a>. </p>
<p>Si l'appareil que vous utilisez pour visualiser la VR n'est pas le même ordinateur que celui sur lequel vous travaillez, vous devez servir votre page web via https, sinon le navigateur n'autorisera pas l'utilisation de l'API WebXR. Le serveur mentionné dans <a href="setup.html">l'article sur la configuration</a> appelé <a href="https://greggman.github.io/servez">Servez</a> propose une option pour utiliser https. Cochez-la et démarrez le serveur. </p>
<div class="threejs_center"><img src="../resources/images/servez-https.png" class="nobg" style="width: 912px;"></div>

<p>Notez les URL. Vous avez besoin de celle qui correspond à l'adresse IP locale de votre ordinateur. Elle commencera généralement par <code class="notranslate" translate="no">192</code>, <code class="notranslate" translate="no">172</code> ou <code class="notranslate" translate="no">10</code>. Saisissez cette adresse complète, y compris la partie <code class="notranslate" translate="no">https://</code>, dans le navigateur de votre appareil VR. Note : Votre ordinateur et votre appareil VR doivent être sur le même réseau local ou WiFi et vous devez probablement être sur un réseau domestique. Note : De nombreux cafés sont configurés pour interdire ce type de connexion entre machines.</p>
<p>Vous serez accueilli par une erreur similaire à celle ci-dessous. Cliquez sur "advanced" (avancé) puis sur <em>proceed</em> (procéder).</p>
<div class="threejs_center"><img src="../resources/images/https-warning.gif"></div>

<p>Vous pouvez maintenant exécuter vos exemples.</p>
<p>Si vous envisagez sérieusement le développement WebXR, une autre chose que vous devriez apprendre est le <a href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging/">débogage à distance</a> afin de pouvoir voir les avertissements et erreurs de la console, et bien sûr réellement <a href="debugging-javascript.html">déboguer votre code</a>.</p>
<p>Si vous voulez simplement voir le code fonctionner ci-dessous, vous pouvez exécuter le code depuis ce site.</p>
<p>La première chose à faire est d'inclure le support VR après avoir inclus three.js</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">import * as THREE from 'three';
+import {VRButton} from 'three/addons/webxr/VRButton.js';
</pre>
<p>Ensuite, nous devons activer le support WebXR de three.js et ajouter son bouton VR à notre page</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function main() {
  const canvas = document.querySelector('#c');
  const renderer = new THREE.WebGLRenderer({antialias: true, canvas});
+  renderer.xr.enabled = true;
+  document.body.appendChild(VRButton.createButton(renderer));
</pre>
<p>Nous devons laisser three.js gérer notre boucle de rendu. Jusqu'à présent, nous utilisions une boucle <code class="notranslate" translate="no">requestAnimationFrame</code>, mais pour supporter la VR, nous devons laisser three.js gérer notre boucle de rendu pour nous. Nous pouvons le faire en appelant <a href="/docs/#api/en/renderers/WebGLRenderer.setAnimationLoop"><code class="notranslate" translate="no">WebGLRenderer.setAnimationLoop</code></a> et en passant une fonction à appeler pour la boucle.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function render(time) {
  time *= 0.001;

  if (resizeRendererToDisplaySize(renderer)) {
    const canvas = renderer.domElement;
    camera.aspect = canvas.clientWidth / canvas.clientHeight;
    camera.updateProjectionMatrix();
  }

  cubes.forEach((cube, ndx) =&gt; {
    const speed = 1 + ndx * .1;
    const rot = time * speed;
    cube.rotation.x = rot;
    cube.rotation.y = rot;
  });

  renderer.render(scene, camera);

-  requestAnimationFrame(render);
}

-requestAnimationFrame(render);
+renderer.setAnimationLoop(render);
</pre>
<p>Il y a un autre détail. Nous devrions probablement définir une hauteur de caméra qui est à peu près la moyenne pour un utilisateur debout.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
+camera.position.set(0, 1.6, 0);
</pre>
<p>et déplacer les cubes vers le haut pour qu'ils soient devant la caméra</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const cube = new THREE.Mesh(geometry, material);
scene.add(cube);

cube.position.x = x;
+cube.position.y = 1.6;
+cube.position.z = -2;
</pre>
<p>Nous les avons placés à <code class="notranslate" translate="no">z = -2</code> car la caméra sera maintenant à <code class="notranslate" translate="no">z = 0</code> et la caméra par défaut regarde le long de l'axe -z.</p>
<p>Cela soulève un point extrêmement important. <strong>Les unités en VR sont en mètres</strong>. En d'autres termes, <strong>Une Unité = Un Mètre</strong>. Cela signifie que la caméra est à 1,6 mètre au-dessus de 0. Les centres des cubes sont à 2 mètres devant la caméra. Chaque cube mesure 1x1x1 mètre. C'est important car la VR doit ajuster les éléments en fonction de l'utilisateur <em>dans le monde réel</em>. Cela signifie que les unités utilisées dans three.js doivent correspondre aux mouvements de l'utilisateur.</p>
<p>Et avec cela, nous devrions obtenir 3 cubes tournants devant la caméra avec un bouton pour entrer en mode VR.</p>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/manual/examples/resources/editor.html?url=/manual/examples/webxr-basic.html"></iframe></div>
  <a class="threejs_center" href="/manual/examples/webxr-basic.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<p>Je trouve que la VR fonctionne mieux si nous avons quelque chose autour de la caméra pour référence, comme une pièce. Ajoutons donc un simple cubemap en grille comme nous l'avons vu dans <a href="backgrounds.html">l'article sur les arrière-plans</a>. Nous utiliserons simplement la même texture de grille pour chaque côté du cube, ce qui nous donnera une pièce en grille.</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">const scene = new THREE.Scene();
+{
+  const loader = new THREE.CubeTextureLoader();
+  const texture = loader.load([
+    'resources/images/grid-1024.png',
+    'resources/images/grid-1024.png',
+    'resources/images/grid-1024.png',
+    'resources/images/grid-1024.png',
+    'resources/images/grid-1024.png',
+    'resources/images/grid-1024.png',
+  ]);
+  scene.background = texture;
+}
</pre>
<p>C'est mieux.</p>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/manual/examples/resources/editor.html?url=/manual/examples/webxr-basic-w-background.html"></iframe></div>
  <a class="threejs_center" href="/manual/examples/webxr-basic-w-background.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<p>Note : Pour réellement voir la VR, vous aurez besoin d'un appareil compatible WebXR. Je pense que la plupart des téléphones Android peuvent supporter WebXR en utilisant Chrome ou Firefox. Pour iOS, vous pourriez être en mesure d'utiliser cette <a href="https://apps.apple.com/us/app/webxr-viewer/id1295998056">WebXR App</a> bien qu'en général le support de WebXR sur iOS ne soit pas pris en charge depuis mai 2019.</p>
<p>Pour utiliser WebXR sur Android ou iPhone, vous aurez besoin d'un <em>casque VR</em> pour téléphones. Vous pouvez en trouver pour un prix allant de 5 $ pour un modèle en carton à 100 $. Malheureusement, je ne sais pas lesquels recommander. J'en ai acheté 6 au fil des ans et ils sont tous de qualité variable. Je n'ai jamais payé plus d'environ 25 $.</p>
<p>Pour mentionner quelques-uns des problèmes</p>
<ol>
<li><p>Correspondent-ils à votre téléphone</p>
<p>Les téléphones existent dans une variété de tailles et les casques VR doivent donc s'adapter. De nombreux casques prétendent s'adapter à une grande variété de tailles. Mon expérience est que plus ils prétendent s'adapter à de tailles, moins ils sont bons, car au lieu d'être conçus pour une taille spécifique, ils doivent faire des compromis pour s'adapter à plus de tailles. Malheureusement, les casques multi-tailles sont le type le plus courant.</p>
</li>
<li><p>Peuvent-ils faire la mise au point pour votre visage</p>
<p>Certains appareils ont plus d'ajustements que d'autres. Généralement, il y a au maximum 2 ajustements : la distance des lentilles par rapport à vos yeux et l'écart entre les lentilles.</p>
</li>
<li><p>Sont-ils trop réfléchissants</p>
<p>De nombreux casques ont un cône en plastique de votre œil au téléphone. Si ce plastique est brillant ou réfléchissant, il agira comme un miroir reflétant l'écran et sera très gênant.</p>
<p>Peu ou pas de critiques semblent couvrir ce problème.</p>
</li>
<li><p>Sont-ils confortables sur votre visage.</p>
<p>La plupart des appareils reposent sur votre nez comme une paire de lunettes. Cela peut faire mal après quelques minutes. Certains ont des sangles qui font le tour de votre tête. D'autres ont une 3ème sangle qui passe par-dessus la tête. Celles-ci peuvent aider ou non à maintenir l'appareil au bon endroit.</p>
<p>Il s'avère que pour la plupart (tous ?) les appareils, vos yeux doivent être centrés avec les lentilles. Si les lentilles sont légèrement au-dessus ou en dessous de vos yeux, l'image devient floue. Cela peut être très frustrant car les choses peuvent commencer nettes, mais 45 à 60 secondes plus tard, l'appareil s'est déplacé de 1 millimètre vers le haut ou vers le bas et vous réalisez soudain que vous avez du mal à faire la mise au point sur une image floue.</p>
</li>
<li><p>Peuvent-ils supporter vos lunettes.</p>
<p>Si vous portez des lunettes, vous devrez lire les critiques pour voir si un casque particulier fonctionne bien avec les lunettes.</p>
</li>
</ol>
<p>Je ne peux malheureusement vraiment faire aucune recommandation. <a href="https://vr.google.com/cardboard/get-cardboard/">Google propose des recommandations bon marché fabriquées en carton</a>, certaines coûtant aussi peu que 5 $, alors peut-être commencer par là et si vous aimez, envisagez de passer à un modèle supérieur. 5 $ c'est comme le prix d'un café, alors sérieusement, essayez !</p>
<p>Il existe également 3 types de base d'appareils.</p>
<ol>
<li><p>3 degrés de liberté (3dof), pas de dispositif d'entrée</p>
<p>C'est généralement le style téléphonique, bien que l'on puisse parfois acheter un dispositif d'entrée tiers. Les 3 degrés de liberté signifient que vous pouvez regarder vers le haut/bas (1), gauche/droite (2) et incliner la tête à gauche et à droite (3).</p>
</li>
<li><p>3 degrés de liberté (3dof) avec 1 dispositif d'entrée (3dof)</p>
<p>Il s'agit essentiellement de Google Daydream et Oculus GO</p>
<p>Ceux-ci permettent également 3 degrés de liberté et incluent un petit contrôleur qui agit comme un pointeur laser à l'intérieur de la VR. Le pointeur laser n'a également que 3 degrés de liberté. Le système peut savoir dans quelle direction le dispositif d'entrée pointe, mais il ne peut pas savoir où se trouve le dispositif.</p>
</li>
<li><p>6 degrés de liberté (6dof) avec dispositifs d'entrée (6dof)</p>
<p>C'est <em>la vraie affaire</em> haha. 6 degrés de liberté signifie que ces appareils ne savent pas seulement dans quelle direction vous regardez, mais ils savent aussi où se trouve réellement votre tête. Cela signifie que si vous vous déplacez de gauche à droite, ou d'avant en arrière, ou si vous vous levez/vous asseyez, les appareils peuvent l'enregistrer et tout dans la VR bouge en conséquence. C'est étrangement et incroyablement réaliste. Avec une bonne démo, vous serez époustouflé, ou du moins je l'ai été et je le suis toujours.</p>
<p>De plus, ces appareils incluent généralement 2 contrôleurs, un pour chaque main, et le système peut savoir exactement où sont vos mains et comment elles sont orientées, de sorte que vous pouvez manipuler des objets en VR en tendant simplement la main, en touchant, poussant, tournant, etc...</p>
<p>Les appareils à 6 degrés de liberté incluent le Vive et Vive Pro, l'Oculus Rift et Quest, et je crois tous les appareils Windows MR.</p>
</li>
</ol>
<p>Après avoir couvert tout cela, je ne sais pas avec certitude quels appareils fonctionneront avec WebXR. Je suis sûr à 99% que la plupart des téléphones Android fonctionneront avec Chrome. Vous pourriez avoir besoin d'activer le support WebXR dans <a href="about:flags"><code class="notranslate" translate="no">about:flags</code></a>. Je sais aussi que Google Daydream fonctionnera également et de manière similaire, vous devez activer le support WebXR dans <a href="about:flags"><code class="notranslate" translate="no">about:flags</code></a>. Oculus Rift, Vive et Vive Pro fonctionneront via Chrome ou Firefox. Je suis moins sûr pour Oculus Go et Oculus Quest car ils utilisent tous deux des OS personnalisés, mais selon internet, ils semblent tous deux fonctionner.</p>
<p>Ok, après ce long détour sur les appareils VR et WebXR, il y a quelques points à aborder</p>
<ul>
<li><p>Support de la VR et de la non-VR</p>
<p>Autant que je sache, au moins à partir de r112, il n'y a pas de moyen simple de supporter à la fois les modes VR et non-VR avec three.js. Idéalement, si vous n'êtes pas en mode VR, vous devriez pouvoir contrôler la caméra par les moyens de votre choix, par exemple les <a href="/docs/#examples/controls/OrbitControls"><code class="notranslate" translate="no">OrbitControls</code></a>, et vous recevriez un événement lors du passage en mode VR et de la sortie pour pouvoir activer/désactiver les contrôles.</p>
</li>
</ul>
<p>Si three.js ajoute un support pour faire les deux, j'essaierai de mettre à jour cet article. D'ici là, vous pourriez avoir besoin de 2 versions de votre site OU passer un indicateur dans l'URL, quelque chose comme</p>
<pre class="prettyprint showlinemods notranslate notranslate" translate="no">https://mysite.com/mycooldemo?allowvr=true
</pre><p>Ensuite, nous pourrions ajouter quelques liens pour changer de mode</p>
<pre class="prettyprint showlinemods notranslate lang-html" translate="no">&lt;body&gt;
  &lt;canvas id="c"&gt;&lt;/canvas&gt;
+  &lt;div class="mode"&gt;
+    &lt;a href="?allowvr=true" id="vr"&gt;Autoriser la VR&lt;/a&gt;
+    &lt;a href="?" id="nonvr"&gt;Utiliser le mode non-VR&lt;/a&gt;
+  &lt;/div&gt;
&lt;/body&gt;
</pre>
<p>et du CSS pour les positionner</p>
<pre class="prettyprint showlinemods notranslate lang-css" translate="no">body {
    margin: 0;
}
#c {
    width: 100%;
    height: 100%;
    display: block;
}
+.mode {
+  position: absolute;
+  right: 1em;
+  top: 1em;
+}
</pre>
<p>dans votre code, vous pourriez utiliser ce paramètre comme ceci</p>
<pre class="prettyprint showlinemods notranslate lang-js" translate="no">function main() {
  const canvas = document.querySelector('#c');
  const renderer = new THREE.WebGLRenderer({antialias: true, canvas});
-  renderer.xr.enabled = true;
-  document.body.appendChild(VRButton.createButton(renderer));

  const fov = 75;
  const aspect = 2;  // the canvas default
  const near = 0.1;
  const far = 5;
  const camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
  camera.position.set(0, 1.6, 0);

+  const params = (new URL(document.location)).searchParams;
+  const allowvr = params.get('allowvr') === 'true';
+  if (allowvr) {
+    renderer.xr.enabled = true;
+    document.body.appendChild(VRButton.createButton(renderer));
+    document.querySelector('#vr').style.display = 'none';
+  } else {
+    // no VR, add some controls
+    const controls = new OrbitControls(camera, canvas);
+    controls.target.set(0, 1.6, -2);
+    controls.update();
+    document.querySelector('#nonvr').style.display = 'none';
+  }
</pre>
<p>Si c'est bien ou mal, je ne sais pas. J'ai l'impression que les différences entre ce qui est nécessaire pour la VR et ce qui est nécessaire pour la non-VR sont souvent très différentes, donc pour tout sauf les choses les plus simples, peut-être que 2 pages séparées sont mieux ? Vous devrez décider.</p>
<p>Note : pour diverses raisons, cela ne fonctionnera pas dans l'éditeur en direct sur ce site. Donc, si vous voulez l'essayer, <a href="../examples/webxr-basic-vr-optional.html" target="_blank">cliquez ici</a>. Il devrait démarrer en mode non-VR et vous pouvez utiliser la souris ou les doigts pour déplacer la caméra. Cliquer sur "Allow VR" (Autoriser la VR) devrait basculer en mode VR, et vous devriez pouvoir cliquer sur "Enter VR" (Entrer en mode VR) si vous êtes sur un appareil VR.</p>
<ul>
<li><p>Décider du niveau de support VR</p>
<p>Ci-dessus, nous avons couvert 3 types d'appareils VR.</p>
<ul>
<li>3DOF sans entrée</li>
<li>3DOF + entrée 3DOF</li>
<li>6DOF + entrée 6DOF</li>
</ul>
<p>Vous devez décider du niveau d'effort que vous êtes prêt à consacrer pour supporter chaque type d'appareil.</p>
<p>Par exemple, l'appareil le plus simple n'a pas d'entrée. Le mieux que vous puissiez généralement faire est de créer des boutons ou des objets dans la vue de l'utilisateur et si l'utilisateur aligne un marqueur au centre de l'affichage sur ces objets pendant environ une demi-seconde, ce bouton est cliqué. Une UX courante consiste à afficher un petit minuteur qui apparaît au-dessus de l'objet, indiquant que si vous maintenez le marqueur là pendant un instant, l'objet/bouton sera sélectionné.</p>
<p>Comme il n'y a pas d'autre entrée, c'est à peu près le mieux que vous puissiez faire</p>
</li>
</ul>
<p>Comme vous pouvez le voir, démarrer en VR est assez simple, mais créer quelque chose de commercialisable en VR nécessitera beaucoup de décisions et de conception.</p>
<p>Ceci était une introduction assez brève à la VR avec three.js. Nous couvrirons certaines méthodes d'entrée dans de <a href="webxr-look-to-select.html">futurs articles</a>.</p>

        </div>
      </div>
    </div>

  <script src="../resources/prettify.js"></script>
  <script src="../resources/lesson.js"></script>




</body></html>