import { SRGBColorSpace, LinearSRGBColorSpace } from '../constants.js';
import { ColorManagement } from './ColorManagement.js';

class Color {

	constructor( r = 1, g = 1, b = 1, a = 1 ) {

		this.isColor = true;

		this.r = 1;
		this.g = 1;
		this.b = 1;
		this.a = 1;

		return this.set( r, g, b, a );

	}

	set( r, g, b, a = this.a ) {

		if ( g === undefined && b === undefined ) {

			// single argument

			if ( r && r.isColor ) {

				this.copy( r );

			} else if ( typeof r === 'number' ) {

				this.setHex( r );

			} else if ( typeof r === 'string' ) {

				this.setStyle( r );

			}

		} else {

			this.setRGBA( r, g, b, a );

		}

		return this;

	}

	setRGBA( r, g, b, a = 1, colorSpace = ColorManagement.workingColorSpace ) {

		this.r = r;
		this.g = g;
		this.b = b;
		this.a = a;

		if ( colorSpace !== ColorManagement.workingColorSpace ) {

			ColorManagement.toWorkingColorSpace( this, colorSpace );

		}

		return this;

	}

	copy( color ) {

		this.r = color.r;
		this.g = color.g;
		this.b = color.b;
		this.a = color.a !== undefined ? color.a : 1;

		return this;

	}

	clone() {

		return new this.constructor( this.r, this.g, this.b, this.a );

	}

	equals( c ) {

		return (
			c.r === this.r &&
			c.g === this.g &&
			c.b === this.b &&
			c.a === this.a
		);

	}

	getStyle( colorSpace = SRGBColorSpace ) {

		const r = Math.round( this.r * 255 );
		const g = Math.round( this.g * 255 );
		const b = Math.round( this.b * 255 );

		if ( this.a < 1 ) {

			return `rgba(${ r },${ g },${ b },${ this.a })`;

		}

		return `rgb(${ r },${ g },${ b })`;

	}

}

export { Color };
